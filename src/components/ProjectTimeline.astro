---

interface WorkEntry {
  company: string;
  role: string;
  period: string;
  description: string;
  highlights: string[];
}

const workHistory: WorkEntry[] = [
  {
    company: "Upwork",
    role: "Full-Time Freelance Flutter Developer",
    period: "Jul 2024 - Present",
    description:
      "Delivering production-ready mobile and web applications for international clients across diverse industries — SaaS, AI integrations, payment systems, IoT dashboards, and enterprise tools.",
    highlights: [
      "16+ total jobs and counting, Top Rated badge, 100% Job Success Score",
      "SaaS, AI, payments, IoT & enterprise solutions",
      "End-to-end delivery for global clients",
    ],
  },
  {
    company: "Crackin'Code",
    role: "Freelance Flutter Developer",
    period: "Nov 2024 - Jan 2025",
    description:
      "Collaborated with a distributed team to deliver mobile features, integrate REST APIs, and optimize existing modules for performance and usability.",
    highlights: [
      "Feature development & bug resolution",
      "REST API integration & data processing",
      "Maintained clean, project-standard codebase",
    ],
  },
  {
    company: "PT Baracipta Esa Engineering",
    role: "Flutter Developer Intern",
    period: "Aug 2023 - Dec 2023",
    description:
      "Worked with UI/UX designers and backend engineers to deliver production-ready mobile features with real-time data processing and responsive interfaces.",
    highlights: [
      "REST API integration for operational workflows",
      "Translated design specs into responsive UI",
      "Testing, debugging & release refinement",
    ],
  },
];
---

<section class="mb-24" id="history">
  <h2 class="section-label">Work History</h2>
  <div class="mt-8 relative ml-2 md:ml-4 pl-8 md:pl-12">
    
    <div
      class="absolute left-0 top-0 bottom-0 w-px bg-slate-200/50 dark:bg-slate-800/50"
    >
    </div>
    
    <div
      id="timeline-progress"
      class="absolute left-0 top-0 w-px bg-accent origin-top"
      style="height: 0%; transition: height 0.3s ease-out;"
    >
    </div>

    {
      workHistory.map((job, index) => (
        <div
          class:list={[
            "journey-entry relative",
            index === workHistory.length - 1 ? "mb-8" : "mb-20",
          ]}
          style={`--entry-delay: ${index * 150}ms;`}
        >
          
          <div class="journey-dot absolute left-[-5px] top-2 w-2.5 h-2.5 rounded-full border-2 border-white dark:border-[#050505] z-10 bg-slate-300 dark:bg-slate-700 transition-all duration-500" />

          <div class="journey-content">
            <div class="flex flex-col md:flex-row md:items-baseline gap-2 mb-4">
              <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">
                {job.period}
              </span>
              <h3 class="text-xl font-bold text-black dark:text-white uppercase tracking-tight">
                {job.company}
              </h3>
            </div>

            <div class="lg:max-w-xl">
              
              <div class="mb-3">
                <span class="tech-tag">{job.role}</span>
              </div>

              <p class="text-[14px] leading-relaxed mb-5 text-slate-600 dark:text-slate-400">
                {job.description}
              </p>

              <div class="border-t border-slate-100 dark:border-slate-800 pt-4">
                <h4 class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-3">
                  Key Highlights
                </h4>
                <ul class="space-y-1.5">
                  {job.highlights.map((item) => (
                    <li class="flex items-start gap-2 text-[12px] text-slate-600 dark:text-slate-400">
                      <span class="text-accent mt-0.5 text-[8px]">●</span>
                      {item}
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          </div>
        </div>
      ))
    }
  </div>
</section>

<style>
  
  .journey-content {
    opacity: 0;
    transform: translateX(-12px);
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
  }

  .journey-entry.content-visible .journey-content {
    opacity: 1;
    transform: translateX(0);
  }

  .journey-dot {
    transition:
      background-color 0.4s ease,
      box-shadow 0.4s ease,
      transform 0.4s ease;
  }

  .journey-entry.dot-active .journey-dot {
    background-color: #00ff66;
    box-shadow:
      0 0 0 4px rgba(0, 255, 102, 0.15),
      0 0 12px rgba(0, 255, 102, 0.3);
    transform: scale(1.3);
  }

  .journey-entry:not(.dot-active) .journey-dot {
    background-color: rgb(203 213 225); 
    box-shadow: none;
    transform: scale(1);
  }

  :global(.dark) .journey-entry:not(.dot-active) .journey-dot {
    background-color: rgb(51 65 85); 
  }
</style>

<script>

  const contentObserver = new IntersectionObserver(
    (observed) => {
      observed.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("content-visible");
          contentObserver.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.15, rootMargin: "0px 0px -30px 0px" },
  );

  document.querySelectorAll(".journey-entry").forEach((entry) => {
    contentObserver.observe(entry);
  });

  const entries = document.querySelectorAll(".journey-entry");
  const progressLine = document.getElementById("timeline-progress");
  const section = document.getElementById("history");
  const timelineContainer = section?.querySelector(".relative.ml-2");

  function updateTimeline() {
    if (!section || !progressLine || !timelineContainer) return;

    const containerRect = timelineContainer.getBoundingClientRect();
    const containerTop = containerRect.top;
    const containerHeight = containerRect.height;
    const viewportHeight = window.innerHeight;

    const scanLineY = viewportHeight * 0.6;
    const scrolledPx = scanLineY - containerTop;

    const progress = Math.min(Math.max(scrolledPx / containerHeight, 0), 1);
    progressLine.style.height = `${progress * 100}%`;

    const lineTipPx = progress * containerHeight;

    entries.forEach((entry) => {
      const el = entry as HTMLElement;
      const entryOffsetTop = el.offsetTop + 8;

      if (lineTipPx >= entryOffsetTop) {
        el.classList.add("dot-active");
      } else {
        el.classList.remove("dot-active");
      }
    });
  }

  window.addEventListener("scroll", updateTimeline, { passive: true });
  window.addEventListener("resize", updateTimeline, { passive: true });
  updateTimeline();
</script>
